# ============================================================
# DRIFT VISION 2 - Main Configuration File
# ============================================================
# 이 파일은 전체 시스템의 메인 설정 파일입니다.
# 모델, 데이터셋, 드리프트 감지, 비디오 입력 등 모든 핵심 설정을 관리합니다.
# ============================================================

# ------------------------------------------------------------
# Database Configuration - 데이터베이스 설정
# ------------------------------------------------------------
datadrift_table: datadrift_db  # 드리프트 데이터를 저장할 PostgreSQL 테이블 이름

# ------------------------------------------------------------
# Dataset Configuration - 데이터셋 설정
# ------------------------------------------------------------
datasets:
  base_path: ../datasets  # 데이터셋 저장 기본 경로 (프로젝트 외부에 저장 가능)
  objdet_save_data: true  # 객체 검출 시 이미지와 annotation 저장 여부
                          # true: collected/good_images 또는 wronged_images에 저장
                          # false: 저장하지 않음 (메모리/디스크 절약)
  use_last_merged_data_4train: false  # 학습 시 기존 merged 데이터 재사용 여부
                                       # true: 마지막 merged_data 사용 (빠른 재학습)
                                       # false: 새로 collected 데이터 merge (최신 데이터 반영)

# ------------------------------------------------------------
# Server Configuration - 서버 설정
# ------------------------------------------------------------
server:
  ip: 0.0.0.0      # FastAPI 서버 바인딩 IP (0.0.0.0 = 모든 인터페이스)
  port: 18880      # FastAPI 서버 포트

# ------------------------------------------------------------
# PostgreSQL Database Connection - PostgreSQL 연결 설정
# ------------------------------------------------------------
postgres:
  host: 127.0.0.1       # PostgreSQL 서버 주소
  port: 5432            # PostgreSQL 포트 (기본값: 5432)
  dbname: postgres      # 데이터베이스 이름
  user: postgres        # 사용자 이름
  password: postgres    # 비밀번호

# ------------------------------------------------------------
# Video Input Configuration - 비디오 입력 설정
# ------------------------------------------------------------
video:
  source: D:/videos/Craziest Security Camera Captures! _ Caught on Cam _ Funny Moments.mp4
  # 비디오 소스: 파일 경로 또는 "0" (웹캠)
  # 예시: "0" (기본 웹캠), "rtsp://..." (IP 카메라), "video.mp4" (파일)

  camera_id: '007'  # 카메라 식별 ID (DB 저장 및 로그에 사용)

# ------------------------------------------------------------
# YOLO Model Configuration - YOLO 모델 설정
# ------------------------------------------------------------
yolo_model:
  model_name: .\model\yolov8nGender_20251110_v6.pt  # 현재 사용 중인 YOLO 모델 경로
                                                      # 학습 후 자동으로 업데이트됨

  conf_thresh: 0.3  # 객체 검출 confidence 임계값 (0.0~1.0)
                    # 낮을수록 더 많이 검출하지만 오탐지 증가
                    # 높을수록 정확하지만 놓치는 객체 증가

  allow_classes: all  # 검출할 클래스 필터
                      # "all": 모든 클래스 검출
                      # "person, car, dog": 특정 클래스만 검출 (쉼표로 구분)

  criteria_classes: person  # 모델 업데이트 기준이 되는 핵심 클래스
                            # 이 클래스의 성능이 임계값 이상 개선되어야 모델 업데이트
                            # drift detection의 class_name과 동일하게 설정 권장

  last_model_update: '2025-11-10T19:16:32.098084'  # 마지막 모델 업데이트 시간 (ISO 8601)
                                                    # 자동으로 기록됨 (수동 수정 불필요)

# ------------------------------------------------------------
# Model Update Criteria - 모델 업데이트 기준
# ------------------------------------------------------------
model_update:
  overall_map_threshold: 0.0  # 전체 mAP50-95 개선 최소값
                               # 신규 모델이 구 모델보다 이 값 이상 개선되어야 업데이트
                               # 0.0 = 조금이라도 개선되면 업데이트
                               # 0.05 = 5% 이상 개선되어야 업데이트

  criteria_class_map_threshold: 0.01  # 기준 클래스 mAP50 개선 최소값 (%)
                                       # criteria_classes의 성능이 이 값 이상 개선되어야 업데이트
                                       # 0.01 = 1% 이상 개선되어야 업데이트

  auto_update: true  # 자동 모델 업데이트 활성화 여부
                     # true: 기준 충족 시 자동으로 프로덕션 모델 교체
                     # false: 수동으로 모델 선택 (평가만 수행)

  backup_old_model: false  # 구 모델 백업 여부
                           # true: model/backups/에 이전 모델 백업
                           # false: 백업하지 않음 (디스크 공간 절약)

  config_check_interval: 10.0  # 모델 config 체크 주기 (초)
                                # yolo_producer가 이 주기로 config.yaml을 확인하여
                                # model_name이 변경되면 새 모델 자동 로딩

# ------------------------------------------------------------
# Drift Detection Configuration - 드리프트 감지 설정
# ------------------------------------------------------------
drift_detection:
  drift_check_period: 1 days  # 드리프트 체크 시 분석할 데이터 기간
                               # 예: "1 days", "12 hours", "2 days"
                               # PostgreSQL interval 형식 사용

  cooldown_after_update: 30 minutes  # 모델 업데이트 후 쿨다운 기간
                                      # 신규 모델 배포 후 이 시간 동안은 드리프트 체크 스킵
                                      # 모델 안정화 시간 확보용

  partition_create_hour: 23    # 일별 파티션 생성 시각 (시)
  partition_create_minute: 0   # 일별 파티션 생성 시각 (분)
                               # 매일 23:00에 다음날 파티션 생성
                               # DB 성능 최적화를 위한 자동 파티션 관리

# ------------------------------------------------------------
# Preview Configuration - 미리보기 설정
# ------------------------------------------------------------
preview:
  roi_jpeg_quality: 80  # ROI 이미지 JPEG 압축 품질 (0~100)
                        # 높을수록 화질 좋지만 네트워크/저장 용량 증가
                        # 80 = 품질과 용량의 균형

  show_preview: 1  # 실시간 미리보기 창 표시 여부
                   # 1: 표시 (디버깅/모니터링용)
                   # 0: 표시 안 함 (프로덕션 권장)

# ------------------------------------------------------------
# CLIP Model Configuration - CLIP VLM 모델 설정
# ------------------------------------------------------------
clip_model:
  model_name_low: ViT-B/32   # 경량 CLIP 모델 (빠르지만 정확도 낮음)
  model_name_high: ViT-L/14  # 고성능 CLIP 모델 (느리지만 정확도 높음)
                             # 현재 시스템은 model_name_low 사용 중

# ------------------------------------------------------------
# VLM Verification Intervals - VLM 검증 주기 설정
# ------------------------------------------------------------
vlm_intervals:
  interval_sec: 10  # VLM 검증 실행 주기 (초)
                    # YOLO 검출 후 이 주기마다 CLIP으로 재검증

  window_sec: 30    # VLM 검증 윈도우 크기 (초)
                    # 최근 이 시간 내의 검출만 검증 대상
